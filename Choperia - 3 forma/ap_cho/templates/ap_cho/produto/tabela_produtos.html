{% extends 'base.html' %}
{% load static %}
{% block 'titulo' %} Produtos {% endblock %}
{% block 'conteudonav' %} 
    <!-- NAVBAR -->
    <nav>
        <i class='bx bx-menu'></i>
        <a href="#" class="nav-link">Categories</a>
        <form action="#">
            <div class="form-input">
                <input type="search" placeholder="Search...">
                <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
            </div>
        </form>
        
        <input type="checkbox" id="switch-mode" hidden>
        <label for="switch-mode" class="switch-mode"></label>
        <a href="#" class="notification">
            <i class='bx bxs-bell'></i>
            <span class="num">8</span>
        </a>
        <a href="#" data-bs-toggle="dropdown" class="nav-icon pe-md-0">
            <img src="{% static 'ap_cho/img/people.png' %}" class="avatar img-fluid rounded-circle" alt="">
        </a>
        <div class="dropdown-menu dropdown-menu-end rounded">
            <a href="#" class="dropdown-item">
                <i class="lni lni-timer"></i>
                <span>Analytics</span>
            </a>
            <a href="#" class="dropdown-item">
                <i class="lni lni-cog"></i>
                <span>Setting</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
                <i class="lni lni-question-circle"></i>
                <span>Analytics</span>
            </a>
        </div>
    </nav>
    <!-- NAVBAR -->
{% endblock %} 

{% block 'conteudo1' %}
    <div class="head-title">
        <div class="left">
            <h1>Produtos</h1>
            <ul class="breadcrumb">
                <li>
                    <a href="#">Produtos</a>
                </li>
                <li><i class='bx bx-chevron-right' ></i></li>
                <li>
                    <a class="active" href="#">Home</a>
                </li>                
            </ul>            
        </div>        
        <a href="#" class="btn-download">
            <i class='bx bxs-cloud-download' ></i>
            <span class="text">Download PDF</span>
        </a>
    </div>

    <ul class="box-info">
        <li>
            <i class='bx bxs-calendar-check' ></i>
            <span class="text">
                <h3>{{ total_estoque }} Unidade(S)</h3>
                <p>Estoque Atual</p>
            </span>
        </li>
        <li>
            <i class='bx bxs-group' ></i>
            <span class="text">
                <h3>R$ {{ total_custo_estoque }}</h3>
                <p>Custo do Estoque</p>
            </span>
        </li>
        <li>
            <i class='bx bxs-dollar-circle' ></i>
            <span class="text">
                <h3>R$ {{ total_valor_estoque }}</h3>
                <p>Valor do Estoque</p>
            </span>
        </li>
    </ul>
    <ul class="box-info">
        <li>
            <i class='bx bxs-calendar-check' ></i>
            <span class="text">
                <h3>{{ total_reposicao_estoque }}</h3>
                <p>Repor Estoque</p>
            </span>
        </li>
        <li>
            <i class='bx bxs-group' ></i>
            <span class="text">
                <h3>{{ total_estoque_zerado }}</h3>
                <p>Estoque Vazio</p>
            </span>
        </li>
        <li>
            <i class='bx bxs-dollar-circle' ></i>
            <span class="text">
                <h3>{{ total_valor_estoque_total }}</h3>
                <p>Produtos Cadastrados</p>
            </span>
        </li>
    </ul>
{% endblock %}

{% block 'conteudo' %}
<div id="produtos-container">
    <br><br>
    <div class="row">
        <div class="col-12">
            <li class="nav-item" style="display: flex; justify-content: space-between; align-items: center;"> 
                <h3>Produtos Cadastrados</h3> 
                <button type="button" class="btn btn-primary rounded-pill btn-custom" data-bs-toggle="modal" data-bs-target="#produtoModal"> 
                    <i class='bx bx-plus-circle'></i> 
                    <span class="text">Cadastrar Produto</span> 
                </button>
            </li>
            <br>
            <div id="produtos-table-container">
                {% include "ap_cho/produto/partial_produtos_table.html" %}
            </div>
        </div>
    </div>
</div>

<!-- Modal for adding a new product -->
<div class="modal fade" id="produtoModal" tabindex="-1" aria-labelledby="produtoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="produtoModalLabel">Cadastrar Produto</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-produto" method="POST" hx-post="{% url 'valida_cadastro_produto' %}" hx-target="#produtos-table-container" hx-swap="outerHTML" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="categoria" class="form-label">Categoria</label>
                        <input type="text" class="form-control" id="categoria" name="categoria" required>
                    </div>
                    <div class="mb-3">
                        <label for="nome_produto" class="form-label">Nome do Produto</label>
                        <input type="text" class="form-control" id="nome_produto" name="nome_produto" required>
                    </div>
                    <div class="mb-3">
                        <label for="descricao" class="form-label">Descrição</label>
                        <textarea class="form-control" id="descricao" name="descricao" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="custo" class="form-label">Custo</label>
                        <input type="number" class="form-control" id="custo" name="custo" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="venda" class="form-label">Venda</label>
                        <input type="number" class="form-control" id="venda" name="venda" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="codigo" class="form-label">Código</label>
                        <input type="number" class="form-control" id="codigo" name="codigo" required>
                    </div>
                    <div class="mb-3">
                        <label for="estoque" class="form-label">Estoque</label>
                        <input type="number" class="form-control" id="estoque" name="estoque" required>
                    </div>
                    <div class="mb-3">
                        <label for="estoque_total" class="form-label">Estoque Total</label>
                        <input type="number" class="form-control" id="estoque_total" name="estoque_total" required>
                    </div>
                    <div class="mb-3">
                        <label for="imagem" class="form-label">Imagem</label>
                        <input type="file" class="form-control" id="imagem" name="imagem">
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
